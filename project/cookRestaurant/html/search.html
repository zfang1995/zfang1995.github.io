<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="../css/search.css">
    <link rel="stylesheet" href="../css/zf/tweak_toolkit.css">
    <title>搜索</title>
</head>
<body title="map" id="body-gaodeditu">
    <div title="search bar" class="inputBar displayFlex panel _3" id="div-searchBar-1" style="z-index: 1;background-color: white;">
        <div title='circle'>&#9679;</div>
        <div>
            <input type="text" placeholder="查查周围的餐馆..." id="input-search">
            <div style="color: #888;" id='div-myLocation'>成都</div>
        </div>
        <div title='search logo' style="background-image: url(../img/magnifier.svg);" type="" ><label for="input-search"></label></div>
    </div>
    <div id="div-suggestionsBox">
        
    </div>
    <nav class="displayFlex having5EqualWidthColumns" id='nav-1' style="z-index: 1;background-color: white;">
            <div class="nav-item column" role='img' style="background-image: url(../img/ic-facvorites.svg);" id='i1'>收藏</div>
            <div class="nav-item column" role='img' style="background-image: url(../img/ic-history.png);" id='i2'>历史</div>
            <div class="nav-item column" >
                <div style="background-image: url(../img/ic-search.png);" role='img' class="" id='i3'><label for="input-search"></label></div>
            </div>
            <div class="nav-item column" role='img' style="background-image: url(../img/ic-cart.png);" id='i4'>购物车</div>
            <div class="nav-item column" role='img' style="background-image: url(../img/ic-user.png);" id='i5'>账户资料</div>
    </nav>
<script type="text/javascript" src='../js/auto-size.js'></script>
<script type="text/javascript" src='../js/jquery.min.js'></script>
<script type="text/javascript" src='../js/debounce.js'></script>
<!-- 加载高德地图 -->
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=8f8f329ee673f7e9a9accaa2986a6531"></script> 
<script type="text/javascript">
    var obj_map = new AMap.Map('body-gaodeditu',{

    });
//启用高德地图的定位功能
obj_map.plugin('AMap.Geolocation', function () {
    geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            timeout: 10000,          //超过10秒后停止定位，默认：无穷大
            buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            showButton: false,
            panToLocation: true,
            showMarker: true,
            zoomToAccuracy: true      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
        });
    obj_map.addControl(geolocation);
    geolocation.getCurrentPosition();
    AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
    AMap.event.addListener(geolocation, 'error', onError);      //返回定位出错信息
});
  //解析定位结果
  var str_location;
    function onComplete(data) {
        var str=['定位成功'];
        str.push('经度：' + data.position.getLng());
        str.push('纬度：' + data.position.getLat());
        if(data.accuracy){
             str.push('精度：' + data.accuracy + ' 米');
        }//如为IP精确定位结果则没有精度信息
        str.push('是否经过偏移：' + (data.isConverted ? '是' : '否'));
        str_location =str[1].match(/([\d.])+/g)[0] + ',' + str[2].match(/([\d.])+/g);
        console.log(str_location);
    }
    //解析定位错误信息
    function onError(data) {
        console.log('定位失败');
    }
    // 赋予搜索框——搜索功能
    document.getElementById('input-search').addEventListener('keypress', debounce(searchRestuanrant,1000));
    function searchRestuanrant (argument) {
            var str_searchInfo = document.getElementById('input-search').value;
            jQuery.ajax({
                url: 'https://restapi.amap.com/v3/place/around',
                type: 'GET',
                // jsonpCallback: 'dealResponseData',
                data: {
                    key: 'f25d32d71c1754f022b8393bc2b38f1e',
                    keywords: str_searchInfo,
                    location: str_location,
                    types: '050000',
                    offset: '3'
                    // callback: 'dealResponseData'
                }
            })
            .done(function(responseData) {
                console.log("success");
                // console.log(str_searchInfo);
                dealResponseData(responseData);
            })
            .fail(function() {
                console.log("error");
            })
            .always(function() {
                console.log("complete");
            })
    }
    // function dealResponseData (obj_argument) {

    //     // step 1:  prepare formatted data
    //     var obj_suggestionPanel = $('<div title=\"suggestion panel\" id=\"div-suggestionPanel-1\" class=\"panel-1\"><div title=\"thumbnail of Restaurant\" style=\"background-image:url(\'..\/img\/restaruant%20(1).png\')\" id=\"div-thumbnail-1\"><\/div><div><h5><\/h5><div   style=\"color:#888\"><\/div><\/div><div title=\"search logo\" style=\"background-image:url(..\/img\/ic-arrow.svg)\"><\/div><\/div>');
    //     var arr_suggestionPanels = [];
    //     for (var i = 0; i < obj_argument.pois.length; i++) { // loop 3 times
    //         eval('var obj_suggestionPanel'+i+' = Object.create(obj_suggestionPanel)');
    //         arr_suggestionPanels.push(eval('obj_suggestionPanel'+i));
    //         console.log(arr_suggestionPanels[i][0].id);
    //         arr_suggestionPanels[i][0].id = 'div-suggestionPanel-'+(i+1);

    //     // step 2:  load the data into page
    //         console.log(arr_suggestionPanels[i][0]); 
    //         // console print: 
    //         // <div id="div-suggestionPanel-1">,
    //         // <div id="div-suggestionPanel-2">,
    //         // <div id="div-suggestionPanel-3">  
    //         document.getElementById('div-suggestionsBox').appendChild(arr_suggestionPanels[i][0]); 
    //         // webpage output：
    //         // <div id="div-suggestionPanel-3"> ,
    //         // <div id="div-suggestionPanel-3"> ,
    //         // <div id="div-suggestionPanel-3">  
    //     }
    //     console.log(arr_suggestionPanels[0]===arr_suggestionPanels[1]); 
    //         //console print: false
    // }
    function dealResponseData(json){
        var dObj_suggestionsBox = document.getElementById('div-suggestionsBox');
        while (dObj_suggestionsBox.firstChild){
            dObj_suggestionsBox.removeChild(dObj_suggestionsBox.firstChild);
        }
        var str_suggestionPanel = '<div title=\"suggestion panel\" id=\"div-suggestionPanel-1\" class=\"panel _4\"><div title=\"thumbnail of Restaurant\" style=\"background-image:url(\'..\/img\/restaruant%20(1).png\')\" class=\"thumbnail-1\"><\/div><div><h6><\/h6><div style=\"color:#888;white-space:nowrap;\"><\/div><div style=\"margin:1em 0\"><span class=\"starsGroup\"><span class=\"icon-yellowStar iconfont\"><\/span> <span class=\"icon-yellowStar iconfont\"><\/span> <span class=\"icon-yellowStar iconfont\"><\/span> <span class=\"icon-yellowStar iconfont\"><\/span> <span class=\"icon-yellowStar iconfont\"><\/span><\/span><\/div><\/div><div title=\"goto logo\" style=\"background-image:url(..\/img\/ic-arrow.svg)\"><\/div><\/div>';
        function run(){
            var $_suggestionPanel = $(str_suggestionPanel);
            $_suggestionPanel[0].id = 'div-suggestionPanel-'+(i+1);  
            $_suggestionPanel[0].children[1].children[0].textContent =  json.pois[i].name;
            $_suggestionPanel[0].children[1].children[1].textContent = json.pois[i].address;
            dObj_suggestionsBox.appendChild($_suggestionPanel[0]);
        }
        for(var i=0;i<json.pois.length;i++){
            run();
        }
        
    }
    // 点击搜索框时，placeholder消失。
    $('#input-search').each(function(index, el) {
        this.a = this.placeholder;
        this.addEventListener('pointerenter', function () {
            this.placeholder = '';
        })
        this.addEventListener('pointerout', function () {
            this.placeholder = this.a;
        })

    });
</script>
<script type="text/javascript">
    $('#nav-1 .nav-item')[0].addEventListener('click',function () {
        document.location = 'Favorites.html'
    })
    $('#nav-1 .nav-item')[1].addEventListener('click',function () {
        document.location = 'History.html'
    })
    $('#nav-1 .nav-item')[3].addEventListener('click',function () {
        document.location = 'MyCart.html'
    })
    $('#nav-1 .nav-item')[4].addEventListener('click',function () {
        document.location = 'Profile.html'
    })
</script>
</body>
</html>